"use client";
import React, { useEffect, useRef } from "react";
import styles from "@/styles/content/loader.module.css";

export default function HangerLoader() {
  const svgRef = useRef(null);

  useEffect(() => {
    const paths = svgRef.current.querySelectorAll("path");

    const animate = () => {
      paths.forEach((path, index) => {
        const length = path.getTotalLength();
        path.style.strokeDasharray = length;
        path.style.strokeDashoffset = length;
        path.style.transition = "none";

        path.getBoundingClientRect(); // force reflow

        const duration = 2000; // durée de l’animation
        const delay = index * 300; // délai progressif par path

        // dessine
        setTimeout(() => {
          path.style.transition = `stroke-dashoffset ${duration}ms ease-in-out`;
          path.style.strokeDashoffset = 0;
        }, delay);

        // rétracte
        setTimeout(() => {
          path.style.transition = `stroke-dashoffset ${duration}ms ease-in-out`;
          path.style.strokeDashoffset = length;
        }, duration + delay);
      });
    };

    animate(); // première boucle

    const interval = setInterval(
      () => {
        animate();
      },
      2 * 2000 + paths.length * 300
    ); // total durée forward + reverse

    return () => clearInterval(interval); // cleanup
  }, []);

  return (
    <div className={styles.loaderContainer}>
      <svg
        ref={svgRef}
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 375 374.999991"
        width="200"
        height="200"
      >
        <g>
          <path
            d="M 345.621094 265.886719 C 357.734375 272.753906 364.085938 272.503906 365.824219 271.269531 C 366.261719 270.964844 366.269531 270.691406 366.21875 270.445312 C 365.984375 269.363281 363.925781 267.441406 359.242188 266.5625 C 357.5625 266.25 352.792969 266.03125 345.621094 265.886719 Z M 36.148438 265.875 C 27.722656 265.875 22.015625 266.332031 19.734375 267.242188 C 15.757812 268.824219 8.898438 273.871094 10.261719 278.90625 C 10.71875 280.585938 11.585938 281.597656 12.992188 282.089844 C 19.976562 284.53125 36.832031 273.90625 48.007812 266.109375 C 43.621094 265.953125 39.648438 265.875 36.148438 265.875 Z M 15.25 285.234375 C 14.085938 285.234375 13.011719 285.078125 12.0625 284.742188 C 9.765625 283.941406 8.242188 282.222656 7.542969 279.640625 C 5.59375 272.429688 14.210938 266.414062 18.691406 264.628906 C 23.476562 262.726562 38.210938 262.847656 51.769531 263.453125 C 53.433594 262.253906 54.875 261.203125 56 260.378906 C 57.480469 259.296875 58.617188 258.464844 59.324219 257.980469 C 75.925781 246.660156 92.6875 234.980469 108.902344 223.683594 L 119.875 216.039062 C 124.410156 212.878906 128.9375 209.679688 133.464844 206.480469 C 147.703125 196.421875 162.425781 186.019531 177.542969 176.839844 C 178.214844 176.449219 179.078125 176.644531 179.476562 177.3125 C 179.878906 177.976562 179.667969 178.839844 179.003906 179.246094 C 163.972656 188.367188 149.289062 198.742188 135.09375 208.777344 C 130.550781 211.980469 126.023438 215.179688 121.480469 218.347656 L 110.507812 225.988281 C 94.296875 237.289062 77.527344 248.976562 60.910156 260.304688 C 60.222656 260.773438 59.105469 261.589844 57.664062 262.644531 C 57.199219 262.984375 56.730469 263.324219 56.265625 263.667969 C 56.941406 263.703125 57.617188 263.738281 58.28125 263.777344 C 73.828125 264.632812 135.089844 264.113281 199.929688 263.558594 C 251.964844 263.117188 305.242188 262.660156 335.457031 262.945312 C 325.503906 256.679688 311.191406 247.488281 295.042969 237.117188 C 260.128906 214.695312 220.554688 189.28125 207.027344 181.851562 C 194.507812 174.972656 189.96875 171.167969 189.019531 166.773438 C 188.121094 162.625 190.949219 158.429688 194.445312 153.773438 C 194.59375 153.601562 201.078125 146.410156 207.480469 138.285156 C 216 127.476562 215.332031 118.761719 215.328125 118.671875 C 215.324219 104.078125 203.542969 92.308594 189.0625 92.308594 C 174.582031 92.308594 162.792969 104.078125 162.792969 118.542969 C 162.792969 119.320312 162.164062 119.949219 161.390625 119.949219 C 160.613281 119.949219 159.980469 119.320312 159.980469 118.542969 C 159.980469 102.53125 173.03125 89.496094 189.0625 89.496094 C 205.09375 89.496094 218.136719 102.53125 218.136719 118.542969 C 218.167969 118.804688 218.960938 128.261719 209.6875 140.027344 C 203.226562 148.226562 196.679688 155.488281 196.613281 155.558594 C 193.046875 160.316406 191.183594 163.464844 191.769531 166.183594 C 192.5 169.554688 197 173.136719 208.378906 179.386719 C 222 186.867188 261.613281 212.304688 296.5625 234.753906 C 314.957031 246.5625 330.96875 256.847656 340.847656 263.011719 C 350.929688 263.152344 357.640625 263.402344 359.761719 263.800781 C 364.832031 264.75 368.355469 267.066406 368.96875 269.84375 C 369.285156 271.304688 368.730469 272.660156 367.449219 273.566406 C 364.070312 275.945312 355.359375 275.316406 340.933594 266.375 C 340.636719 266.1875 340.320312 265.992188 340.003906 265.796875 C 311.058594 265.414062 254.820312 265.902344 199.953125 266.371094 C 135.046875 266.925781 73.753906 267.449219 58.128906 266.585938 C 56.234375 266.480469 54.382812 266.386719 52.605469 266.304688 C 39.113281 275.914062 24.253906 285.234375 15.25 285.234375"
            stroke="#393536"
            strokeWidth="2"
            fill="none"
            strokeLinecap="round"
            strokeLinejoin="round"
          />
        </g>
      </svg>
    </div>
  );
}
